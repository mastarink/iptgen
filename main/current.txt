*mangle

:PREROUTING DROP
:INPUT DROP
:FORWARD DROP
:OUTPUT DROP
:POSTROUTING DROP


COMMIT
*nat

# :PREROUTING ACCEPT
# :INPUT ACCEPT
# :OUTPUT ACCEPT
# :POSTROUTING ACCEPT

# Accepting forwarded packets via the firewall's internal IP device allows LAN nodes to communicate with each other; 
# however they still cannot communicate externally to the Internet.
# To allow LAN nodes with private IP addresses to communicate with external public networks, 
# configure the firewall for IP masquerading, which masks requests from LAN nodes with the IP address of the firewall's external device

# -A POSTROUTING -s 192.168.71.0/24 -o enp2s0 -j LOG --log-prefix "ipt4: P/R " --log-uid --log-tcp-options --log-ip-options --log-level 7
# -A POSTROUTING -s 192.168.71.0/24 -o enp2s0 -j MASQUERADE

-A POSTROUTING -o enp2s0 -s 192.168.71.230 -j MASQUERADE
-A POSTROUTING -o enp2s0 -s 192.168.71.80/28 -j MASQUERADE

COMMIT
*filter


:INPUT DROP
:FORWARD DROP
:OUTPUT DROP



:acpt_known -

# -A acpt_known -j LOG --log-prefix "ipt4: YES known " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acpt_known -j ACCEPT





:drop_known -

-A drop_known -j LOG --log-prefix "ipt4: NOT known " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A drop_known -j DROP





:ask_skype -
:ask_sopcast -
:ask_pingme -
:ask_torrent -
:ask_rtmp -
:ask_gentoo -
:ask_2akamai -
:ask_other_http -

-A ask_2akamai -j LOG --log-prefix  "ipt4: YES ask to akamai " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A ask_2akamai -j ACCEPT -m comment --comment (go)
-A ask_gentoo -j LOG --log-prefix  "ipt4: YES ask gentoo " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A ask_gentoo -j ACCEPT -m comment --comment (go)
-A ask_other_http -j LOG --log-prefix  "ipt4: YES ask other http " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A ask_other_http -j ACCEPT -m comment --comment (go)
-A ask_rtmp -j ACCEPT -m comment --comment (go)
-A ask_skype -j LOG --log-prefix  "ipt4: YES ask skype " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A ask_skype -j ACCEPT -m comment --comment (go)
# -A ask_skype   -j drop_known -m comment --comment skype


# -- accept_log LOG ask_torrent ask torrent --


# -A ask_torrent -j LOG --log-prefix "ipt4: YES ask torrent " --log-uid --log-tcp-options --log-ip-options --log-level 7
# -A ask_torrent -j drop_known -m comment --comment torrent
-A ask_torrent -j acpt_known -m comment --comment torrent


-A ask_sopcast -j acpt_known
-A ask_pingme  -j acpt_known



:acpt_pingme -
:acpt_inet -


-A acpt_pingme -j LOG --log-prefix "ipt4: YES ping me. " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acpt_pingme -j ACCEPT



-A acpt_inet -m tcp -p tcp --sport xmpp-client -j ACCEPT

# -A acpt_inet -j LOG --log-prefix "ipt4: YES from/to inet. " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acpt_inet -j ACCEPT





:acptFWinet -
:acptFWinet_nolog -

### -A acptFWinet -j LOG --log-prefix "ipt4: SHOW acpt FW " --log-uid --log-tcp-options --log-ip-options --log-level 7


# -A acptFWinet -j LOG --log-prefix "ipt4: YES fw inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
# -A acptFWinet -j acpt_inet

-A acptFWinet -j LOG --log-prefix  "ipt4: YES fw inet " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A acptFWinet -j acpt_inet -m comment --comment (go)
-A acptFWinet_nolog -j acpt_inet -m comment --comment (go)




:dropFWlstd -

-A dropFWlstd -j LOG --log-prefix "ipt4: NOT drop FW lstd " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFWlstd -j DROP



:dropFWinet -

### -A dropFWinet -j LOG --log-prefix "ipt4: SHOW drop FW " --log-uid --log-tcp-options --log-ip-options --log-level 7


-A dropFWinet -d 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18 -m comment --comment msft -j dropFWlstd
-A dropFWinet -s 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18 -m comment --comment msft -j dropFWlstd


-A dropFWinet -s 192.168.71.66 -m tcp -p tcp --dport http -j DROP

-A dropFWinet -j LOG --log-prefix "ipt4: NOT fw inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFWinet -j DROP



:tcpFWinet -


### -A tcpFWinet -j LOG --log-prefix "ipt4: SHOW tcp FW " --log-uid --log-tcp-options --log-ip-options --log-level 7

-A tcpFWinet -m tcp -p tcp -o enp4s0 -i enp2s0 -d 192.168.71.230 -s 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18 -m multiport --sports http,https,8080 -j dropFWinet -m comment --comment msft_mac
-A tcpFWinet -m tcp -p tcp -i enp4s0 -o enp2s0 -s 192.168.71.230 -d 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18 -m multiport --dports http,https,8080 -j dropFWinet -m comment --comment msft_mac


# android
-A tcpFWinet -m tcp -p tcp -o enp4s0 -i enp2s0 -d 192.168.71.230 -m multiport --sports http,https,8080 -j acptFWinet -m comment --comment android
-A tcpFWinet -m tcp -p tcp -i enp4s0 -o enp2s0 -s 192.168.71.230 -m multiport --dports http,https,8080 -j acptFWinet -m comment --comment android

# -A tcpFWinet -m tcp -p tcp -o enp4s0 -i enp2s0 -d 192.168.71.230              --sport 5228:5230   -j acptFWinet -m comment --comment android
# -A tcpFWinet -m tcp -p tcp -i enp4s0 -o enp2s0 -s 192.168.71.230              --dport 5228:5230   -j acptFWinet -m comment --comment android
-A tcpFWinet -m tcp -p tcp -o enp4s0 -i enp2s0 -d 192.168.71.230              --sport 5222:5230   -j acptFWinet -m comment --comment android
-A tcpFWinet -m tcp -p tcp -i enp4s0 -o enp2s0 -s 192.168.71.230              --dport 5222:5230   -j acptFWinet -m comment --comment android


-A tcpFWinet  -m tcp -p tcp -o enp2s0 -s 192.168.71.230 --dport 10041:10042 -j acptFWinet -m comment --comment t2skype


-A tcpFWinet -j dropFWinet





:udpFWinet -

### -A udpFWinet -j LOG --log-prefix "ipt4: SHOW udp FW " --log-uid --log-tcp-options --log-ip-options --log-level 7

-A udpFWinet -m udp -p udp -o enp2s0 --dport domain -j acptFWinet
-A udpFWinet -m udp -p udp -i enp2s0 --sport domain -j acptFWinet

# Skype
-A udpFWinet -m udp -p udp  -s 192.168.71.230 -m multiport --sports 64231,51634,36493,63700 -j acptFWinet -m comment --comment skype-fw
-A udpFWinet -m udp -p udp  -d 192.168.71.230 -m multiport --sports 64231,51634,36493,63700 -j acptFWinet -m comment --comment skype-fw
-A udpFWinet -m udp -p udp  -s 192.168.71.230 -m multiport --dports 64231,51634,36493,63700 -j acptFWinet -m comment --comment skype-fw
-A udpFWinet -m udp -p udp  -d 192.168.71.230 -m multiport --dports 64231,51634,36493,63700 -j acptFWinet -m comment --comment skype-fw

-A udpFWinet -m tcp -p tcp  -d 192.168.71.230 --sport 40000:49500  -j acptFWinet -m comment --comment skype-fw
-A udpFWinet -m tcp -p tcp  -s 192.168.71.230 --sport 40000:49500  -j acptFWinet -m comment --comment skype-fw

-A udpFWinet -m udp -p udp  -d 192.168.71.230 --sport 40000:49500  -j acptFWinet -m comment --comment skype-fw
-A udpFWinet -m udp -p udp  -d 192.168.71.230 --dport 40000:49500  -j acptFWinet -m comment --comment skype-fw
-A udpFWinet -m udp -p udp  -s 192.168.71.230 --sport 40000:49500  -j acptFWinet -m comment --comment skype-fw


-A udpFWinet -m udp -p udp  -d 192.168.71.230 --sport ntp  -j acptFWinet -m comment --comment time
-A udpFWinet -m udp -p udp  -s 192.168.71.230 --dport ntp  -j acptFWinet -m comment --comment time


# -A udpFWinet -j LOG --log-prefix "ipt4: QST udp fw inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A udpFWinet -j dropFWinet





:icmpFWinet -


### -A icmpFWinet -j LOG --log-prefix "ipt4: SHOW ICMP FW " --log-uid --log-tcp-options --log-ip-options --log-level 7

-A icmpFWinet -m icmp -p icmp --icmp-type 3 -j acptFWinet


# -A icmpFWinet -m icmp -p icmp --icmp-type 8 -d 188-244-26-74.itnet.md -j acptFWinet
-A icmpFWinet -m icmp -p icmp --icmp-type 8 -d 188.244.26.74,188.244.26.91,173.194.0.0/16,74.125.0.0/16,216.239.32.0/19 -j acptFWinet
-A icmpFWinet -m icmp -p icmp --icmp-type 0 -s 188.244.26.74,188.244.26.91,173.194.0.0/16,74.125.0.0/16,216.239.32.0/19 -j acptFWinet

-A icmpFWinet -m icmp -p icmp --icmp-type 11 -d 173.194.0.0/16,74.125.0.0/16,216.239.32.0/19 -j acptFWinet
-A icmpFWinet -m icmp -p icmp --icmp-type 11 -s 173.194.0.0/16,74.125.0.0/16,216.239.32.0/19 -j acptFWinet

-A icmpFWinet -j LOG --log-prefix "ipt4: QST ICMP fw inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A icmpFWinet -j dropFWinet





:FWinet -


### -A FWinet -j LOG --log-prefix "ipt4: SHOW FW " --log-uid --log-tcp-options --log-ip-options --log-level 7



-A FWinet -m tcp -p tcp -j tcpFWinet
-A FWinet -m udp -p udp -j udpFWinet
-A FWinet -m icmp -p icmp --icmp-type any -j icmpFWinet
-A FWinet -j dropFWinet



:vboxFWinet -


# -A vboxFWinet -j LOG --log-prefix "ipt4: YES TCP vb fw inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A vboxFWinet -j acptFWinet



-A FORWARD -p all -s 192.168.71.80/28 --j vboxFWinet
-A FORWARD -p all -d 192.168.71.80/28 --j vboxFWinet


-A FORWARD -o enp2s0 -j FWinet
-A FORWARD -i enp2s0 -j FWinet

# -A FORWARD -o enp4s0 -j FWlan
# -A FORWARD -i enp4s0 -j FWlan

# -A FORWARD -o lo -j FWlocal
# -A FORWARD -i lo -j FWlocal

-A FORWARD  -j LOG --log-prefix "ipt4: DROP FORWARD. " --log-uid --log-tcp-options --log-ip-options --log-level 7





:acpt2inet -
:acpt2inet_nolog -

-A acpt2inet -j LOG --log-prefix  "ipt4: YES to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A acpt2inet -j acpt_inet -m comment --comment (go)
-A acpt2inet_nolog -j acpt_inet -m comment --comment (go)


:drop2ip_lstd -
:drop2port_lstd -
:drop2ip_govua -
:drop2ip_msft -
:drop2ip_http -
:drop2ip_q_http -
:drop2ip_q_hmas -
:drop2ip_q_hff -
:drop2ip_q_hbr -
:drop2ip_q_skype -
:drop2ip_q_happ -
:drop2ip_q_him -

-A drop2ip_lstd -j LOG --log-prefix  "ipt4: NOT drop to lstd " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_lstd -j DROP -m comment --comment (go)
-A drop2port_lstd -j LOG --log-prefix  "ipt4: NOT drop port lstd " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2port_lstd -j DROP -m comment --comment (go)
-A drop2ip_govua -j LOG --log-prefix  "ipt4: NOT drop GOV UA " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_govua -j DROP -m comment --comment (go)
-A drop2ip_msft -j LOG --log-prefix  "ipt4: NOT drop MSFT " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_msft -j DROP -m comment --comment (go)
-A drop2ip_q_hmas -j LOG --log-prefix  "ipt4: NOT to inet u/d HTTP mastar " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_q_hmas -j DROP -m comment --comment (go)
-A drop2ip_q_hff -j LOG --log-prefix  "ipt4: NOT to inet u/d HTTP ff " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_q_hff -j DROP -m comment --comment (go)
-A drop2ip_q_hbr -j LOG --log-prefix  "ipt4: NOT to inet u/d HTTP br " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_q_hbr -j DROP -m comment --comment (go)

-A drop2ip_q_skype -j LOG --log-prefix  "ipt4: NOT to inet u/d H/skype " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_q_skype -j DROP -m comment --comment (go)
-A drop2ip_q_happ -j LOG --log-prefix  "ipt4: NOT to inet u/d HTTP app " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_q_happ -j DROP -m comment --comment (go)
-A drop2ip_q_him -j LOG --log-prefix  "ipt4: NOT to inet u/d HTTP IM " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_q_him -j DROP -m comment --comment (go)


-A drop2ip_q_http  -m owner --gid-owner 1000 -j drop2ip_q_hmas
-A drop2ip_q_http  -m owner --gid-owner 1022 -j drop2ip_q_hff
-A drop2ip_q_http  -m owner --gid-owner 1071 -j drop2ip_q_happ
-A drop2ip_q_http  -m owner --gid-owner 1067 -j drop2ip_q_hbr
-A drop2ip_q_http  -m owner --gid-owner 1068 -j drop2ip_q_skype
-A drop2ip_q_http  -m owner --gid-owner 1073 -j drop2ip_q_him

-A drop2ip_q_http -j LOG --log-prefix  "ipt4: NOT to inet undef HTTP " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_q_http -j DROP -m comment --comment (go)
-A drop2ip_http -j LOG --log-prefix  "ipt4: NOT drop HTTP " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ip_http -j DROP -m comment --comment (go)


:drop2inet -
:root2inet -

-A drop2inet -m owner --uid-owner 0 -m comment --comment "root2inet" -j root2inet
-A root2inet -j LOG --log-prefix  "ipt4: YES ROOT to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A root2inet -j ACCEPT -m comment --comment (go)

# avahi
-A drop2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m owner --uid-owner 107  -m comment --comment "avahi" -j DROP

# 0405:173058 ipt: [265045.485121] NOT from inet IN=enp2s0 OUT= MAC=meth0:90:e2:ba:0f:76:c0:08:00 SRC=195.78.69.6 DST=INET LEN=48 TOS=0x00 PREC=0x40 TTL=123 ID=50866 PROTO=TCP SPT=18824 DPT=22 WINDOW=65535 RES=0x00 SYN URGP=0 OPT (020405B401010402) 
-A drop2inet -d 195.78.68.0/23,193.29.204.0/24,193.19.152.0/22 -m comment --comment msft -j drop2ip_govua

-A drop2inet -d 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18 -m comment --comment drop-msft -j drop2ip_msft
-A drop2inet -d 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18,213.186.116.20,89.184.82.130,88.212.196.64/26,87.240.128.0/19,93.186.224.0/22,93.186.228.0/22,109.87.83.0/24 -m comment --comment other-droplist -j drop2ip_lstd

-A drop2inet -p tcp -m multiport --dports http,https,8080 -d 88.212.196.64/26 -m comment --comment liveinternet -j drop2ip_http
-A drop2inet -p tcp -m multiport --dports http,https,8080 -d 87.240.128.0/19,93.186.224.0/22,93.186.228.0/22 -m comment --comment vkontakte -j drop2ip_http
-A drop2inet -p tcp -m multiport --dports http,https,8080 -d 82.144.222.105 -m comment --comment other-http-droplist -j drop2ip_http
-A drop2inet -p tcp -m multiport --dports http,https,8080 -m comment --comment other-http-droplist -j drop2ip_q_http

-A drop2inet -j LOG --log-prefix  "ipt4: NOT to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2inet -j DROP -m comment --comment (go)



:tcp2inet -
:http2inet -





# torrent
-A tcp2inet -m tcp -p tcp -d 62.133.161.13 --dport 80  -m owner --gid-owner 1079 -j ask_torrent -m comment --comment torrent

#  -A tcp2inet -m tcp -p tcp -d  --dport 6969 -j ask_torrent -m comment --comment torrent

# torrent


-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080,81 -d 94.242.228.85 -m owner --gid-owner 1067 -j acpt_inet -m comment --comment "www + 81 client books"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080  -j http2inet -m comment --comment "http"


# drop without notice
# -A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports ms-wbt-server,ms-sql-s,microsoft-ds -j drop2port_lstd -m comment --comment "MS WBT Server; Microsoft-SQL-Server; Microsoft-DS"

-A tcp2inet -m tcp -p tcp             --dport domain  -m owner --uid-owner 40  -j acpt2inet -m comment --comment "DOMAIN for named"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 192.30.252.131,192.30.252.0/22 --dport ssh -j acpt2inet -m comment --comment "github ssh client"

# sopcast ?
# -A tcp2inet -m tcp -p tcp -s 193.222.140.165 --dport 3912      -j acpt2inet

-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports nicname,rwhois        -j acpt2inet -m comment --comment "WHOIS client"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165               --dport 8333         -j acpt2inet  -m comment --comment BITCOIN
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports xmpp-client,5050,aol  -j acpt2inet_nolog -m comment --comment "IM client"

# tor
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165  --dport 9001 -j acpt2inet  -m comment --comment "tor"
# -A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165  --sport 9001 -j acpt2inet  -m owner --gid-owner 1014 -m comment --comment "tor"

# ### radio
# ?IP? -A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 46.46.157.130  --dport 8000 -j acpt2inet  -m comment --comment "radio echo.msk"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 194.44.212.228,212.113.37.71,77.88.207.154,77.88.207.156,77.88.207.157,91.194.250.169,212.26.129.2,93.178.246.160  --dport 8000  -m owner --gid-owner 1070 -j acpt2inet  -m comment --comment "radio"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 194.44.212.228,212.113.37.71,77.88.207.154,77.88.207.156,77.88.207.157,91.194.250.169,212.26.129.2,93.178.246.160  --dport 8000  -m owner --gid-owner 1071 -j acpt2inet  -m comment --comment "radio"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 194.44.212.228,212.113.37.71,77.88.207.154,77.88.207.156,77.88.207.157,91.194.250.169,212.26.129.2,93.178.246.160  --dport 8000   -j acpt2inet  -m comment --comment "radio"

-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 217.20.164.163  --dport 8014  -m owner --gid-owner 1070 -j acpt2inet  -m comment --comment "radio"
# ### /radio




# See tcpFinet.rules

-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080  -m owner --gid-owner 250 -j ask_gentoo -m comment --comment gentoo

-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 137.254.120.26,140.211.166.134,156.56.247.195,192.30.252.146,198.41.30.199,216.165.129.135,5.9.69.110,64.50.233.100,64.50.236.52,89.16.167.134,91.191.147.225,92.243.18.55,192.30.252.131,192.30.252.0/22 -m multiport --dports http,https,8080 -j ask_gentoo -m comment --comment gentoo

-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 140.211.166.189,209.177.148.226,5.9.69.110,91.186.30.235             --dport rsync       -j ask_gentoo -m comment --comment gentoo
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 149.20.4.72,192.30.252.131,212.85.158.6,69.175.114.215,87.238.52.168,94.100.119.163               --dport git         -j ask_gentoo -m comment --comment gentoo




# See tcpFinet.rules


# servers # 
-A tcp2inet -m tcp -p tcp -o enp2s0 -s 193.222.140.165 --sport http -j acpt2inet -m comment --comment "my http server"




# See tcpFinet.rules


# clients # >>  91.190.216.9
# -A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d  91.190.216.9 --dport http            -j acpt2inet -m comment --comment "skype client"

-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 --dport 12350            -j ask_skype -m comment --comment "skype client"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 --dport 12350            -j ask_skype -m comment --comment "skype client"
# allow some msft for skype
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 157.54.0.0/15,157.56.0.0/14 --dport 40000:49000 -j ask_skype -m comment --comment "skype client"



# See tcpFinet.rules


# RTMP
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 109.68.46.114,109.68.46.117,109.68.40.0/24  -m multiport --dports http,https,8080 -j ask_rtmp -m comment --comment "http client TVI"

-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d 109.68.46.114,109.68.46.117,109.68.40.0/24 --dport 1935 -j ask_rtmp -m comment --comment "rtmp client TVI"
# -A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -d  --dport 1935 -j ask_rtmp -m comment --comment "rtmp client INTV"




# See tcpFinet.rules


# smtp
# -A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m owner --gid-owner 248 --dport submission -d 173.194.70.108,173.194.70.109 -j acpt2inet -m comment --comment "smtp mail client"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165  --dport submission -d 173.194.70.108,173.194.70.109 -j acpt2inet -m comment --comment "smtp mail client"
-A tcp2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports pop3,pop3s -d 91.203.51.253,173.194.0.0/16,74.125.0.0/16,216.239.32.0/19,173.194.70.108,173.194.70.109 -j acpt2inet -m comment --comment "pop mail client"



:acpt2ihttp -
:acpt2ihttp_nolog -

:drop2ihttp -
:drop2ihttp_nolog -

:acpt2ihttp_known -
:acpt2ihttp_known_nolog -




# See tcpFinet.rules


-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -m owner --gid-owner 1067  -j acpt2ihttp -m comment --comment "http gid mastar-browser"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -m owner --gid-owner 1024  -j acpt2ihttp -m comment --comment "http gid mastar-http"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -m owner --gid-owner 1022  -j acpt2ihttp_nolog -m comment --comment "http gid mastar-firefox"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -m owner --gid-owner   31  -j acpt2ihttp_nolog -m comment --comment "http gid squid"




# See tcpFinet.rules



-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 74.112.184.0/22,213.180.193.53,213.180.204.53,87.250.250.53 -m owner --gid-owner 994 -j acpt2ihttp -m comment --comment "davfs2 client"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 74.112.184.0/22,213.180.193.53,213.180.204.53,87.250.250.53 -j acpt2ihttp -m comment --comment "davfs2 client"



# See tcpFinet.rules


-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 31.13.64.0/18,173.252.64.0/18,69.171.224.0/19,69.63.176.0/20,66.220.144.0/20,204.15.20.0/22,217.212.238.33,217.212.238.25,217.212.238.49,208.80.152.0/22,199.7.48.0/20,173.194.0.0/16,74.125.0.0/16,216.239.32.0/19,195.214.195.109,217.117.65.0/24,199.47.216.0/22,108.160.160.0/20,193.178.147.110,212.113.33.73,89.184.65.74,77.120.126.64/27,66.6.32.0/20 -j acpt2ihttp_known -m comment --comment "www client"



-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 23.32.0.0/11,23.64.0.0/14,95.100.96.0/23,213.248.112.128/25,80.239.178.128/25,2.16.0.0/13,46.33.64.0/21,46.33.72.0/22,46.33.76.0/23,195.27.154.0/24,193.45.10.128/25,62.115.64.128/25,195.59.122.0/24,81.52.207.128/25,217.212.238.0/24,195.27.155.0/24,77.67.91.0/24,213.198.95.128/25,195.10.8.0/23,217.89.107.0/24,62.208.24.0/23,95.100.0.0/20,92.122.189.0/24,195.10.11.0/24,195.59.126.0/24,194.221.64.0/24,80.150.142.0/25,195.59.55.0/24,89.149.151.0/24,92.123.72.0/24,80.157.149.0/24,82.112.106.0/24,213.200.108.0/24,195.59.150.0/24,77.67.96.0/22 -j ask_2akamai -m comment --comment "www client AKAMAI"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 108.168.255.243 -j acpt2ihttp_known -m comment --comment "www client maxmind / geoip"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 208.117.224.0/19 -j acpt2ihttp_known -m comment --comment "www client youtube"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 212.58.224.0/19,87.248.219.53,87.248.219.55 -j acpt2ihttp_known -m comment --comment "www client BBC"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 199.16.156.198,199.16.156.38,199.16.156.70,199.16.156.0/22,199.59.148.0/22 -j acpt2ihttp_known -m comment --comment "www client twitter"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 188.65.120.0/21 -j acpt2ihttp_known -m comment --comment "www client dailymotion"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 74.121.192.202 -j acpt2ihttp_known -m comment --comment "www client samfind bar"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 94.242.228.85,67.205.70.12,108.162.192.0/18,109.163.230.0/23,93.174.88.192 -j acpt2ihttp_known -m comment --comment "www client books"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -d 94.242.228.85,67.205.70.12,108.162.192.0/18,109.163.230.0/23,93.174.88.192 -m owner --gid-owner 1067 -j acpt2ihttp_known -m comment --comment "www client books"

-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -j acpt2ihttp -m comment --comment "http"


-A acpt2ihttp -j LOG --log-prefix  "ipt4: YES to inet HTTP " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A acpt2ihttp -j acpt_inet -m comment --comment (go)
-A acpt2ihttp_nolog -j acpt_inet -m comment --comment (go)

-A drop2ihttp -j LOG --log-prefix  "ipt4: NOT to inet HTTP " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A drop2ihttp -j DROP -m comment --comment (go)
# drop_go_log drop2inet NO drop2ihttp to inet HTTP
-A drop2ihttp_nolog -j drop2inet -m comment --comment (go)

-A acpt2ihttp_known -j LOG --log-prefix  "ipt4: YES to inet HTTP known site " --log-uid --log-tcp-options --log-ip-options --log-level 7 -m comment --comment (go)
-A acpt2ihttp_known -j acpt_inet -m comment --comment (go)
-A acpt2ihttp_known_nolog -j acpt_inet -m comment --comment (go)


# See tcpFinet.rules

# for skype
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -m owner --gid-owner 1068 -j drop2inet -m comment --comment "http gid skype"


##################################
# A....
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -m owner --gid-owner 1000 -j acpt2ihttp -m comment --comment "www client gid1000"
-A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -m multiport --dports http,https,8080 -j drop2ihttp -m comment --comment "www client other"


# mobile picasa : why??? not in log???
# -A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -i enp4s0 -m multiport --dports http,https,8080  -j LOG --log-prefix "ipt4: Wooow " --log-uid --log-tcp-options --log-ip-options --log-level 7
# -A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165 -i enp4s0 -m multiport --dports http,https,8080 -j ask_other_http -m comment --comment "www client"
#? -A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165  -m multiport --dports http,https,8080  -j LOG --log-prefix "ipt4: Wooow " --log-uid --log-tcp-options --log-ip-options --log-level 7
#? -A http2inet -o enp2s0 -m tcp -p tcp -s 193.222.140.165  -m multiport --dports http,https,8080 -j ask_other_http -m comment --comment "www client"



# See tcpFinet.rules


# other #
-A tcp2inet -j LOG --log-prefix "ipt4: NOT tcp other to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A tcp2inet -j drop2inet



:udp2inet -





-A udp2inet -p udp -m udp --dport 33434:33523  -j acpt2inet -m comment --comment "traceroute"

# domain for named daemon
-A udp2inet -m udp -p udp             --dport domain  -m owner --uid-owner 40  -j acpt2inet_nolog -m comment --comment "DOMAIN for named"
-A udp2inet -m udp -p udp             --sport domain  -m owner --uid-owner 40  -j acpt2inet_nolog -m comment --comment "DOMAIN for named"
-A udp2inet -m udp -p udp             --sport domain  -m owner --uid-owner 40  -j acpt2inet_nolog -m comment --comment "DOMAIN for named"
# -A udp2inet -m udp -p udp -d 8.8.4.4  --sport domain  -m owner --uid-owner 40  -j acpt2inet_nolog -m comment --comment "DOMAIN for named"
# -A udp2inet -m udp -p udp -d 8.8.8.8  --sport domain  -m owner --uid-owner 40  -j acpt2inet_nolog -m comment --comment "DOMAIN for named"

# ntp
-A udp2inet -m udp -p udp  -d 108.61.73.244,129.70.132.35,142.54.181.202,147.251.48.140,176.74.25.228,178.23.121.164,188.164.129.130,193.140.100.41,193.243.171.130,193.27.209.1,193.55.167.2,194.50.97.12,199.30.140.76,211.233.84.186,212.113.164.13,212.45.144.3,24.97.48.50,4.53.160.75,5.34.248.224,5.9.80.113,64.246.132.14,69.36.227.90,78.46.197.35,79.188.148.2,83.247.2.80,84.54.128.8,85.10.246.226,88.190.224.56,91.206.8.70,91.236.251.29,93.94.224.67 -s 193.222.140.165 --dport ntp  -j acpt2inet -m comment --comment ntp
-A udp2inet -m udp -p udp                    -s 193.222.140.165 --dport ntp  -j acpt2inet -m comment --comment ntp

# dig
-A udp2inet -m udp -p udp -d 8.8.4.4,8.8.8.8       --dport domain   -j acpt2inet_nolog -m comment --comment "DOMAIN"

# sopcast : DPT=3923:3925
-A udp2inet -m udp -p udp -s 193.222.140.165 --dport 3923:3925 -j ask_sopcast -m comment --comment sopcast
-A udp2inet -m udp -p udp -s 193.222.140.165 --dport 13        -j ask_sopcast -m comment --comment sopcast
-A udp2inet -m udp -p udp -s 193.222.140.165 --sport 3908      -j ask_sopcast -m comment --comment sopcast
-A udp2inet -m udp -p udp -s 193.222.140.165 --dport 3912      -j ask_sopcast -m comment --comment sopcast


# skype
-A udp2inet -m udp -p udp -s 193.222.140.165 --sport 46528      -j ask_skype -m comment --comment skype
# -A udp2inet -m udp -p udp -s 193.222.140.165 --sport 40000:47000      -j ask_skype -m comment --comment skype


# -A udp2inet -j LOG --log-prefix "ipt4: QST udp to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A udp2inet -j drop2inet  -m comment --comment "drop other udp"





:icmp2inet -

# See icmpFinet.rules

-A icmp2inet -m icmp -p icmp --icmp-type 3 -d 8.8.4.4,8.8.8.8 -j acpt2inet
-A icmp2inet -m icmp -p icmp --icmp-type 3 -j acpt2inet

-A icmp2inet -m icmp -p icmp --icmp-type 8 -d 98.136.0.0/14,206.190.32.0/19 -j acpt2inet -m comment --comment "yahoo ping"
-A icmp2inet -m icmp -p icmp --icmp-type 8 -d 173.252.64.0/18 -j acpt2inet -m comment --comment "facebook ping"
-A icmp2inet -m icmp -p icmp --icmp-type 8 -d 173.194.0.0/16 -j acpt2inet -m comment --comment "google ping"
-A icmp2inet -m icmp -p icmp --icmp-type 8 -d 91.194.251.197 -j acpt2inet -m comment --comment "lb.ua ping"
-A icmp2inet -m icmp -p icmp --icmp-type 8 -d 216.92.111.41 -j acpt2inet -m comment --comment "kasparov.ru ping"


-A icmp2inet -m icmp -p icmp --icmp-type 8  -j acpt2inet -m comment --comment "any ping"

# -A icmp2inet -m icmp -p icmp --icmp-type 8 -d 188-244-26-74.itnet.md -j acpt2inet -m comment --comment "moldova ping"
-A icmp2inet -m icmp -p icmp --icmp-type 8 -d 188.244.26.74,188.244.26.91 -j acpt2inet -m comment --comment "moldova ping"

# http://ping.online-domain-tools.com/ 89.185.250.154
-A icmp2inet -m icmp -p icmp --icmp-type 0 -j acpt_pingme -m comment --comment "ping from online-domain-tools.com answer"

-A icmp2inet -m icmp -p icmp --icmp-type 0 -j ask_pingme -m comment --comment "ping from outside answer"




-A icmp2inet -j LOG --log-prefix "ipt4: QST ICMP to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A icmp2inet -j drop2inet





:2inet -
-A OUTPUT -o enp2s0 -j 2inet

# See drop2inet.rules

# -A 2inet -m tcp -p tcp -j LOG --log-prefix "ipt4: MIDDLE TCP to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A 2inet -m tcp -p tcp -j tcp2inet

# -A 2inet -m udp -p udp -j LOG --log-prefix "ipt4: MIDDLE UDP to inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A 2inet -m udp -p udp -j udp2inet

-A 2inet -m icmp -p icmp --icmp-type any -j icmp2inet
-A 2inet -j drop2inet





:acpt2lan -

:tcp_acpt2lan -
:udp_acpt2lan -
:icmp_acpt2lan -

# squid
-A tcp_acpt2lan -m tcp -p tcp --sport 3128 -s 192.168.71.11 -j ACCEPT

-A icmp_acpt2lan -s 192.168.71.0/24 -m icmp --icmp-type 8 -p icmp -j ACCEPT
-A udp_acpt2lan  -s 192.168.71.0/24 -m udp -p udp -m multiport --sports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds -j ACCEPT
-A tcp_acpt2lan  -s 192.168.71.0/24 -m tcp -p tcp -m multiport --sports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds -j ACCEPT

# dns.mastar.lan
-A udp_acpt2lan  -s 192.168.71.10  -m udp -p udp --sport domain -j ACCEPT


-A tcp_acpt2lan -j acpt2lan
-A icmp_acpt2lan -j acpt2lan
-A udp_acpt2lan -j acpt2lan


-A acpt2lan -j LOG --log-prefix "ipt4: YES to lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acpt2lan -j ACCEPT





:drop2lan -

:icmp_drop2lan -
:tcp_drop2lan -
:udp_drop2lan -

# -A udp_drop2lan -m udp -p udp -s 193.222.140.165 -d 224.0.0.251 --sport mdns --dport mdns -j DROP

-A tcp_drop2lan -j drop2lan
-A icmp_drop2lan -j drop2lan
-A udp_drop2lan -j drop2lan

-A drop2lan -j LOG --log-prefix "ipt4: NOT to lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A drop2lan -j DROP





:tcp2lan -


-A tcp2lan -s 192.168.71.0/24 -m tcp -p tcp -m multiport --sports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds -j tcp_acpt2lan

# zocromas
-A tcp2lan -s 192.168.71.0/24 -d 192.168.71.51 -m tcp -p tcp  --dport 5005 -j tcp_acpt2lan


# mpd
-A tcp2lan -d 192.168.71.230 -m tcp -p tcp --sport 6600 -j tcp_acpt2lan



# -A tcp2lan -s 193.222.140.165 -p tcp -m multiport --sports xmpp-client,5050,aol -j tcp_acpt2lan

# apc.mastar.lan
-A tcp2lan -d 192.168.71.22 -p tcp --dport 3551 -j tcp_acpt2lan

# squid
-A tcp2lan -m tcp -p tcp  -d 192.168.71.230,192.168.71.66 -s 192.168.71.11 --sport 3128  -j tcp_acpt2lan

# ??
-A tcp2lan -m tcp -p tcp  -d 192.168.71.230 -s back.mastar.lan --sport 1188  -j tcp_acpt2lan

# ssh local server, remote client
-A tcp2lan -d 192.168.71.230 -s 192.168.71.70,192.168.71.21 -m tcp -p tcp --sport ssh  -j tcp_acpt2lan -m comment --comment "ssh server me21 client 230 (mac.lan)"

# ssh remote server, local client
-A tcp2lan -s 192.168.71.2 -d 192.168.71.230 -m tcp -p tcp --dport ssh  -j tcp_acpt2lan -m comment --comment "ssh servers"

-A tcp2lan -m tcp -p tcp -s 192.168.71.0/24 --sport 46528							-j ask_skype -m comment --comment skype
-A tcp2lan -m tcp -p tcp -s 10.0.2.0/24 --sport 46528							-j ask_skype -m comment --comment skype

-A tcp2lan -m tcp -p tcp -d 192.168.71.0/24 --sport 46528							-j ask_skype -m comment --comment skype
-A tcp2lan -m tcp -p tcp -d 10.0.2.0/24 --sport 46528							-j ask_skype -m comment --comment skype


# calibre-server
-A tcp2lan -d 192.168.71.0/24 -s 192.168.71.26 -m tcp -p tcp --sport 8080  -j tcp_acpt2lan -m comment --comment "calibre server"



# -A tcp2lan -j LOG --log-prefix "ipt4: QST tcp to lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A tcp2lan -j tcp_drop2lan





:udp2lan -

-A udp2lan -m udp -p udp --sport domain										-j udp_acpt2lan
-A udp2lan -m udp -p udp -m multiport -s 192.168.71.0/24 --sports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds	-j udp_acpt2lan
-A udp2lan -m udp -p udp -s 193.222.140.165,192.168.71.0/24 -d 224.0.0.251 --sport mdns --dport mdns			-j udp_acpt2lan
# -A udp2lan -m udp -p udp -s 192.168.71.0/24 -d 224.0.0.251 --dport mdns					-j udp_acpt2lan


-A udp2lan -m udp -p udp -s 192.168.71.0/24 --sport 46528							-j ask_skype -m comment --comment skype
-A udp2lan -m udp -p udp -s 10.0.2.0/24 --sport 46528							-j ask_skype -m comment --comment skype

-A udp2lan -m udp -p udp -d 192.168.71.0/24 --sport 46528							-j ask_skype -m comment --comment skype
-A udp2lan -m udp -p udp -d 10.0.2.0/24 --sport 46528							-j ask_skype -m comment --comment skype


-A udp2lan  -m udp -p udp --dport bootpc --sport bootps -j udp_acpt2lan -m comment --comment dhcp
-A udp2lan  -m udp -p udp --dport bootpc --sport bootps -j udp_acpt2lan -m comment --comment dhcp



# -A udp2lan -j LOG --log-prefix "ipt4: QST udp to lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A udp2lan -j udp_drop2lan





:icmp2lan -

# to ping there
-A icmp2lan -m icmp -p icmp --icmp-type 8 -d 192.168.71.230,192.168.71.66 -j icmp_acpt2lan -m comment --comment icmp_lan_o1

# to ping from there
-A icmp2lan -m icmp -p icmp --icmp-type 0 -d 192.168.71.230,192.168.71.66 -j icmp_acpt2lan -m comment --comment icmp_lan_o2

-A icmp2lan -m icmp -p icmp --icmp-type 3 -d 192.168.71.230,192.168.71.66 -j icmp_acpt2lan -m comment --comment icmp_lan1_o3


# -A icmp2lan -j LOG --log-prefix "ipt4: QST ICMP to lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A icmp2lan -j icmp_drop2lan



:2lan_vbox -

-A 2lan_vbox -j LOG --log-prefix "ipt4: YES TCP vb to lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A 2lan_vbox -j ACCEPT




:2lan -
-A OUTPUT -o enp4s0  -j 2lan

-A 2lan -p all -s 192.168.71.80/28 --j 2lan_vbox
-A 2lan -p all -d 192.168.71.80/28 --j 2lan_vbox

### -A 2lan -j LOG --log-prefix "ipt4: SHOW to lan " --log-uid --log-tcp-options --log-ip-options --log-level 7


-A 2lan -m udp -p udp -j udp2lan
-A 2lan -m icmp -p icmp --icmp-type any -j icmp2lan
-A 2lan -m tcp -p tcp -j tcp2lan
-A 2lan -j drop2lan





:acpt2local -

# -A acpt2local -j LOG --log-prefix "ipt4: YES to local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acpt2local -j ACCEPT





:drop2local -

-A drop2local -j LOG --log-prefix "ipt4: NOT to local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A drop2local -j DROP





:tcp2local -

-A tcp2local -o lo -s 127.0.0.1 -d 127.0.0.1 -p tcp -j acpt2local



-A tcp2local -s 192.168.71.0/26 -p tcp -j acpt2local

# tor
-A tcp2local -p tcp  -m multiport --dports 9050,9051 -j acpt2local
-A tcp2local -p tcp  -m multiport --sports 9050,9051 -j acpt2local
-A tcp2local -p tcp --dport 8123 -j acpt2local
-A tcp2local -p tcp --sport 8123 -j acpt2local




-A tcp2local -p tcp --dport 1188 -j acpt2local
-A tcp2local -p tcp --sport 1188 -j acpt2local

-A tcp2local -s 193.222.140.165 -d 193.222.140.165  -m tcp -p tcp -j acpt2local -m comment --comment "... local"

# ssh remote server, local client
-A tcp2local -s 192.168.71.2 -d 192.168.71.70,192.168.71.21 -m tcp -p tcp --dport ssh  -j acpt2local -m comment --comment "ssh servers local"
-A tcp2local -d 192.168.71.2 -s 192.168.71.70,192.168.71.21 -m tcp -p tcp --sport ssh  -j acpt2local -m comment --comment "ssh servers local"

# mpd.mastar.lan
-A tcp2local -d 192.168.71.25 -p tcp --dport 6600 -j acpt2local
-A tcp2local -s 192.168.71.25 -p tcp --sport 6600 -j acpt2local

# apc.mastar.lan
-A tcp2local -d 192.168.71.22 -p tcp --dport 3551 -j acpt2local
-A tcp2local -s 192.168.71.22 -p tcp --sport 3551 -j acpt2local


-A tcp2local -m tcp -p tcp -m multiport --dports http,https,8080  -j acpt2local -m comment --comment "local http"
-A tcp2local -m tcp -p tcp -m multiport --sports http,https,8080  -j acpt2local -m comment --comment "local http"

-A tcp2local -m tcp -p tcp --dport sunrpc -j acpt2local
-A tcp2local -m tcp -p tcp --sport sunrpc -j acpt2local

# See udp2local.rules
-A tcp2local -m tcp -p tcp --dport domain -j acpt2local
-A tcp2local -m tcp -p tcp --sport domain -j acpt2local


# -A tcp2local -j LOG --log-prefix "ipt4: QST tcp to local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A tcp2local -j drop2local





:udp2local -

-A udp2local -o lo -s 127.0.0.1 -d 127.0.0.1 -p udp -j acpt2local
-A udp2local -o lo -s 192.168.71.0/24 -d 192.168.71.0/24 -p udp -j acpt2local



-A udp2local -i lo -j acpt2local

-A udp2local -s 127.0.0.1 -m udp -p udp --sport 40000:58000 -j acpt2local -m comment --comment skype
-A udp2local -s 127.0.0.1 -m udp -p udp --dport 40000:58000 -j acpt2local -m comment --comment skype

# See tcp2local.rules
-A udp2local -m udp -p udp --dport domain -j acpt2local
-A udp2local -m udp -p udp --sport domain -j acpt2local

-A udp2local  -m udp -p udp --sport 46528							-j acpt2local -m comment --comment skype

# ?? -A udp2local -m udp -p udp --sport 52101 -j acpt2local

# -A udp2local -j LOG --log-prefix "ipt4: QST udp to local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A udp2local -j drop2local





:icmp2local -

-A icmp2local -o lo -j acpt2local

-A icmp2local -j LOG --log-prefix "ipt4: QST ICMP to local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A icmp2local -j drop2local




:2local -
-A OUTPUT -o lo   -j 2local


-A 2local -m udp -p udp -j udp2local
-A 2local -m icmp -p icmp  --icmp-type any -j icmp2local
-A 2local -m tcp -p tcp -j tcp2local
-A 2local -j drop2local



# -A OUTPUT -m state --state INVALID -j LOG --log-prefix "INVALID output: "
### -A   OUTPUT -m state --state INVALID -j LOG --log-prefix "ipt4: NOT INVALID to any " --log-uid --log-tcp-options --log-ip-options --log-level 7
### -A OUTPUT -m state --state INVALID -j DROP

# -A OUTPUT -j LOG --log-prefix "ipt4: Q OUTPUT. " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A OUTPUT -j LOG --log-prefix "ipt4: (default) DROP OUTPUT. " --log-uid --log-tcp-options --log-ip-options --log-level 7



:acptFinet -

# -A acptFinet -j LOG --log-prefix "ipt4: YES from inet. " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acptFinet -j acpt_inet




:dropFip_lstd -
:dropFip_msft -
:dropFip_bad -
:dropFport_lstd -

-A dropFip_lstd -j LOG --log-prefix "ipt4: NOT L/ips F inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFip_lstd -j DROP

-A dropFip_msft -j LOG --log-prefix "ipt4: NOT msft ips F inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFip_msft -j DROP

-A dropFip_bad -j LOG --log-prefix "ipt4: NOT bad ips F inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFip_bad -j DROP

-A dropFport_lstd -j LOG --log-prefix "ipt4: NOT L/ports F inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFport_lstd -j DROP





:dropFinet -

# See dropFlstd.rules

-A dropFinet -s 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18 -m comment --comment drop-msft -j dropFip_msft
-A dropFinet -s 157.54.0.0/15,157.56.0.0/14,157.60.0.0/16,65.52.0.0/14,207.46.0.0/16,64.4.0.0/18,111.221.64.0/18,213.199.160.0/19,70.37.0.0/17,70.37.128.0/18,213.186.116.20,89.184.82.130,88.212.196.64/26,87.240.128.0/19,93.186.224.0/22,93.186.228.0/22,109.87.83.0/24 -m comment --comment other-droplist -j dropFip_lstd
-A dropFinet -s 106.128.0.0/10,66.175.208.0/20 -m comment --comment drop-bad -j dropFip_bad


-A dropFinet -j LOG --log-prefix "ipt4: NOT from inet " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFinet -j DROP





:tcpFinet -






# See tcp2inet.rules


# RTMP
-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -s 109.68.46.114,109.68.46.117,109.68.40.0/24 --sport 1935 -j ask_rtmp -m comment --comment "rtmp client TVI"
# -A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -s  --sport 1935 -j ask_rtmp -m comment --comment "rtmp client INTV"


-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -s 140.211.166.189,209.177.148.226,5.9.69.110,91.186.30.235 --sport rsync                      -j ask_gentoo -m comment --comment gentoo
-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -s 149.20.4.72,192.30.252.131,212.85.158.6,69.175.114.215,87.238.52.168,94.100.119.163   --sport git                        -j ask_gentoo -m comment --comment gentoo
#? ?
-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -s 109.106.1.244,128.95.166.129,131.155.140.135,140.115.50.14,149.20.4.69,198.145.20.140   --sport ftp -m helper --helper ftp -j ask_gentoo -m comment --comment gentoo


# drop without notice
-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -m multiport --dports ms-wbt-server,ms-sql-s,microsoft-ds -j dropFport_lstd -m comment --comment "MS WBT Server; Microsoft-SQL-Server; Microsoft-DS"

# servers #
-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp --dport http                               -j acptFinet -m comment --comment "my http server"

# clients #
# -A tcpFinet -p tcp -i enp2s0 -d 193.222.140.165 -m state --state ESTABLISHED,RELATED -j acptFinet
-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -m conntrack --ctstate RELATED,ESTABLISHED -j acptFinet

-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -m multiport --sports http,https,8080           -j acptFinet
-A tcpFinet -i enp2s0 -d 193.222.140.165 -m tcp -p tcp -m multiport --sports xmpp-client,5050,aol -j acptFinet






:udpFinet  -





# ntp
-A udpFinet -m udp -p udp  -s 108.61.73.244,129.70.132.35,142.54.181.202,147.251.48.140,176.74.25.228,178.23.121.164,188.164.129.130,193.140.100.41,193.243.171.130,193.27.209.1,193.55.167.2,194.50.97.12,199.30.140.76,211.233.84.186,212.113.164.13,212.45.144.3,24.97.48.50,4.53.160.75,5.34.248.224,5.9.80.113,64.246.132.14,69.36.227.90,78.46.197.35,79.188.148.2,83.247.2.80,84.54.128.8,85.10.246.226,88.190.224.56,91.206.8.70,91.236.251.29,93.94.224.67 -d 193.222.140.165 --sport ntp  -j acptFinet -m comment --comment ntp
-A udpFinet -m udp -p udp                    -d 193.222.140.165 --sport ntp  -j acptFinet -m comment --comment ntp


-A udpFinet -m udp -p udp -d 193.222.140.165 --sport domain   -j acptFinet  -m comment --comment "domain for named"
-A udpFinet -m udp -p udp -d 193.222.140.165 --dport domain   -j acptFinet  -m comment --comment "domain for named"
# -m owner not possible for INPUT
# -A udpFinet -m udp -p udp -d 193.222.140.165 --sport domain  -m owner --uid-owner 40     -j acptFinet  -m comment --comment "domain for named"
# -A udpFinet -m udp -p udp -d 193.222.140.165 --dport domain  -m owner --uid-owner 40     -j acptFinet  -m comment --comment "domain for named"

# sopcast : SPT=3923:3925
-A udpFinet -m udp -p udp -d 193.222.140.165 --sport 13         -j ask_sopcast -m comment --comment sopcast
# -A udpFinet -m udp -p udp -s 193.222.140.165 --dport 3908       -j ask_sopcast -m comment --comment sopcast
-A udpFinet -m udp -p udp -d 193.222.140.165 --dport 3908       -j ask_sopcast -m comment --comment sopcast
-A udpFinet -m udp -p udp -d 193.222.140.165 --sport 3912       -j ask_sopcast -m comment --comment sopcast
-A udpFinet -m udp -p udp -d 193.222.140.165 --sport 3923:3925  -j ask_sopcast -m comment --comment sopcast


# skype (should be last)
# -A udpFinet -m udp -p udp -d 193.222.140.165 --dport 46528      -j ask_skype -m comment --comment skype
-A udpFinet -m udp -p udp -d 193.222.140.165 --dport 40000:47000      -j ask_skype -m comment --comment skype

-A udpFinet -j dropFinet





:icmpFinet -

# See icmp2inet.rules

-A icmpFinet -m icmp -p icmp --icmp-type 0 -s 98.136.0.0/14,206.190.32.0/19 -j acptFinet -m comment --comment "yahoo ping answer"
-A icmpFinet -m icmp -p icmp --icmp-type 0 -s 173.252.64.0/18 -j acptFinet -m comment --comment "facebook ping answer"
-A icmpFinet -m icmp -p icmp --icmp-type 0 -s 173.194.0.0/16 -j acptFinet -m comment --comment "google ping answer"
-A icmpFinet -m icmp -p icmp --icmp-type 0 -s 91.194.251.197 -j acptFinet -m comment --comment "lb.ua ping answer"
-A icmpFinet -m icmp -p icmp --icmp-type 0 -s 216.92.111.41 -j acptFinet -m comment --comment "kasparov.ru ping answer"

-A icmpFinet -m icmp -p icmp --icmp-type 0 -j acptFinet -m comment --comment "any ping answer"

-A icmpFinet -m icmp -p icmp --icmp-type 0 -s 188.244.26.74,188.244.26.91 -j acptFinet -m comment --comment "moldova ping answer"
# ?? -A icmpFinet -m icmp -p icmp --icmp-type 8 -s 188.244.26.74,188.244.26.91 -j acptFinet


# http://ping.online-domain-tools.com/ 89.185.250.154
-A icmpFinet -m icmp -p icmp --icmp-type 8 -j acpt_pingme -m comment --comment "ping from online-domain-tools.com"

-A icmpFinet -m icmp -p icmp --icmp-type 8 -j ask_pingme -m comment --comment "ping from outside"

-A icmpFinet -m icmp -p icmp --icmp-type 3 -j ask_pingme -m comment --comment "ping from outside / traceroute"
-A icmpFinet -m icmp -p icmp --icmp-type 11 -j ask_pingme -m comment --comment "ping from outside / traceroute"



# -A icmpFinet -m icmp -p icmp --icmp-type 8 -j DROP
# -A icmpFinet -j DROP

-A icmpFinet -j dropFinet



:Finet -

# See dropFinet.rules

-A Finet -m icmp -p icmp  --icmp-type any -j icmpFinet
-A Finet -m tcp  -p tcp   -j tcpFinet
-A Finet -m udp  -p udp   -j udpFinet

-A Finet -j dropFinet





:acptFlan -
:tcp_acptFlan -
:udp_acptFlan -
:icmp_acptFlan -

# squid

-A icmp_acptFlan -m icmp -p icmp --icmp-type 0 -s 192.168.71.230,192.168.71.66 -j ACCEPT
-A tcp_acptFlan  -m tcp -p tcp --dport 3128 -d 192.168.71.11 -j ACCEPT
-A udp_acptFlan -m udp -p udp -m multiport -s 192.168.71.0/24 --sports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds -j ACCEPT

-A udp_acptFlan -m udp -p udp --dport domain -s 192.168.71.230,192.168.71.66 -j ACCEPT
-A udp_acptFlan -m udp -p udp --sport domain -d 192.168.71.230,192.168.71.66 -j ACCEPT



-A tcp_acptFlan  -j acptFlan
-A icmp_acptFlan -j acptFlan
-A udp_acptFlan  -j acptFlan


-A acptFlan -j LOG --log-prefix "ipt4: YES from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acptFlan -j ACCEPT





:dropFlan -
:tcp_dropFlan -
:udp_dropFlan -
:icmp_dropFlan -

# -A udp_dropFlan -m udp -p udp -d 224.0.0.251 --sport mdns -j DROP
# -A udp_dropFlan -m udp -p udp -s 193.222.140.165 -d 224.0.0.251 --sport mdns --dport mdns -j DROP


-A tcp_dropFlan -j LOG --log-prefix "ipt4: NOT TCP from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A tcp_dropFlan -j DROP

-A icmp_dropFlan -j LOG --log-prefix "ipt4: NOT ICMP from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A icmp_dropFlan -j DROP

-A udp_dropFlan -j LOG --log-prefix "ipt4: NOT UDP from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A udp_dropFlan -j DROP

-A dropFlan -j LOG --log-prefix "ipt4: NOT from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A dropFlan -j DROP





:tcpFlan -

-A tcpFlan -d 192.168.71.0/24 -m tcp -p tcp -m multiport --sports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds -j tcp_acptFlan
-A tcpFlan -s 192.168.71.0/24 -m tcp -p tcp -m multiport --dports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds -j tcp_acptFlan

# mpd
-A tcpFlan -s 192.168.71.230 -m tcp -p tcp --dport 6600 -j tcp_acptFlan


# squid
-A tcpFlan -m tcp -p tcp  -s 192.168.71.230,192.168.71.66 -d 192.168.71.11 --dport 3128  -j tcp_acptFlan

-A tcpFlan -m tcp -p tcp  -s 192.168.71.230 -d back.mastar.lan --dport 1188  -j tcp_acptFlan

# ssh local server, remote client
-A tcpFlan -s 192.168.71.230 -d 192.168.71.70,192.168.71.21 -m tcp -p tcp --dport ssh  -j tcp_acptFlan -m comment --comment "ssh server me21 client 230 (mac.lan)"

# ssh remote server, local client
-A tcpFlan -d 192.168.71.2 -s 192.168.71.230 -m tcp -p tcp --sport ssh  -j tcp_acptFlan -m comment --comment "ssh servers"
-A tcpFlan -d 192.168.71.26 -m tcp -p tcp --dport 8080  -j tcp_acptFlan -m comment --comment "calibre server"

-A tcpFlan -m tcp -p tcp -s 192.168.71.230,10.0.2.0/24 --dport 46528		-j udp_acptFlan -m comment --comment skype

-A tcpFlan -j tcp_dropFlan





:udpFlan -

-A udpFlan -m udp -p udp --dport domain -j udp_acptFlan
-A udpFlan -m udp -p udp -m multiport -s 192.168.71.0/24 --sports netbios-ns,netbios-ssn,netbios-dgm,microsoft-ds -j udp_acptFlan

# Skype
-A udpFlan -m udp -p udp     -s 192.168.71.230 -d 193.222.140.165 -m multiport --sports 64231,51634,36493,63700  -j udp_acptFlan -m comment --comment skype
# -A udpFlan -m udp -p udp  -d 192.168.71.230  -d 193.222.140.165 -m multiport --sports 64231,51634,36493,63700  -j udp_acptFlan -m comment --comment skype
-A udpFlan -m udp -p udp -s 192.168.71.230  -d 193.222.140.165 -m multiport --dports 64231,51634,36493,63700     -j udp_acptFlan -m comment --comment skype
# -A udpFlan -m udp -p udp  -d 192.168.71.230  -d 193.222.140.165 -m multiport --dports 64231,51634,36493,63700  -j udp_acptFlan -m comment --comment skype
-A udpFlan -m udp -p udp -s 192.168.71.230,10.0.2.0/24 --dport 46528					    -j udp_acptFlan -m comment --comment skype


# mike.lan
-A udpFlan -m mac --mac-source 00:0e:2e:26:1b:60 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_mike
# mac.lan
-A udpFlan -m mac --mac-source 00:14:51:3b:57:8c -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_mac
# gnome400.lan ?
-A udpFlan -m mac --mac-source 00:00:1c:d3:d8:73 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_g4

# virtualbox machines
-A udpFlan -m mac --mac-source 08:00:27:0a:3e:c8 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:0f:ee:18 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:33:79:df -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:37:03:94 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:5a:7c:f3 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:64:1b:a8 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:6A:A8:E3 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:9E:08:F7 -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:df:d0:fa -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:e4:69:0f -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:e8:f1:3a -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb
-A udpFlan -m mac --mac-source 08:00:27:f0:82:3f -m udp -p udp --sport bootpc --dport bootps -j udp_acptFlan -m comment --comment dhcp_vb


# [Fri Apr  5 11:31:22 2013] ipt: NOT UDP from lan IN=enp4s0 OUT= MAC=01:00:5e:00:00:fb:00:14:51:3b:57:8c:08:00 SRC=192.168.71.230 DST=224.0.0.251 LEN=579 TOS=0x18 PREC=0x00 TTL=255 ID=11713 PROTO=UDP SPT=5353 DPT=5353 LEN=559 

# IGMP : PROTO=2
# [Fri Apr  5 11:37:26 2013] ipt: NOT from lan IN=enp4s0 OUT= MAC=01:00:5e:00:00:fb:00:14:51:3b:57:8c:08:00 SRC=192.168.71.230 DST=224.0.0.251 LEN=32 TOS=0x00 PREC=0x00 TTL=1 ID=12535 OPT (94040000) PROTO=2 


-A udpFlan -m udp -p udp -s 193.222.140.165,192.168.71.0/24 -d 224.0.0.251 --sport mdns --dport mdns -j udp_acptFlan




-A udpFlan -j udp_dropFlan





:icmpFlan -


# to ping there
-A icmpFlan -m icmp -p icmp --icmp-type 0 -s 192.168.71.230,192.168.71.66 -j icmp_acptFlan -m comment --comment icmp_lan_i1

# to ping from there
-A icmpFlan -m icmp -p icmp --icmp-type 8 -s 192.168.71.230,192.168.71.66 -j icmp_acptFlan -m comment --comment icmp_lan_i2

-A icmpFlan -m icmp -p icmp --icmp-type 3 -s 192.168.71.230,192.168.71.66 -j icmp_acptFlan -m comment --comment icmp_lan_i3


# -A icmpFlan -j LOG --log-prefix "ipt4: QST ICMP from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A icmpFlan -j icmp_dropFlan



:Flan_vbox -


-A Flan_vbox -j LOG --log-prefix "ipt4: YES vb from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A Flan_vbox -j ACCEPT


:Flan -

-A Flan -p all -s 192.168.71.80/28 --j Flan_vbox

### -A Flan -j LOG --log-prefix "ipt4: SHOW from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7

# -A Flan  -j LOG --log-prefix "ipt4: QST from lan " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A Flan -m udp -p udp -j udpFlan
-A Flan -m icmp -p icmp  --icmp-type any -j icmpFlan
-A Flan -m tcp -p tcp -j tcpFlan
-A Flan -j dropFlan





:acptFlocal -

# -A acptFlocal -j LOG --log-prefix "ipt4: YES from local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A acptFlocal -j ACCEPT





:dropFlocal -

-A dropFlocal -j LOG --log-prefix "ipt4: NOT from local " --log-uid --log-tcp-options --log-ip-options --log-level 7

-A dropFlocal -j DROP




:tcpFlocal -

-A tcpFlocal -i lo -j acptFlocal

# ssh remote server, local client
# >> tcp2local !  -A tcpFlocal -d 192.168.71.2 -s 192.168.71.70,192.168.71.21 -m tcp -p tcp --sport ssh  -j acptFlocal -m comment --comment "ssh servers local"

# -A tcpFlocal -j LOG --log-prefix "ipt4: QST tcp from local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A tcpFlocal -j dropFlocal





:udpFlocal -

-A udpFlocal -i lo -j acptFlocal
-A udpFlocal -m udp -p udp --dport domain -j acptFlocal

# -A udpFlocal -j LOG --log-prefix "ipt4: QST udp from local " --log-uid --log-tcp-options --log-ip-options --log-level 7
-A udpFlocal -j dropFlocal




:icmpFlocal -

-A icmpFlocal -i lo -j acptFlocal

# -A icmpFlocal -j LOG --log-prefix "ipt4: QST ICMP from local " --log-uid --log-tcp-options --log-ip-options --log-level 7

-A icmpFlocal -j dropFlocal





:Flocal -

-A Flocal -m udp -p udp -j udpFlocal
-A Flocal -m icmp -p icmp  --icmp-type any -j icmpFlocal
-A Flocal -m tcp -p tcp -j tcpFlocal
-A Flocal -j dropFlocal




# -A INPUT -m state --state INVALID -j LOG --log-prefix "INVALID input: "
### -A   INPUT -m state --state INVALID -j LOG --log-prefix "ipt4: NOT INVALID from any " --log-uid --log-tcp-options --log-ip-options --log-level 7
### -A INPUT -m state --state INVALID -j DROP

# -A INPUT              -j LOG      --log-prefix "ipt4: Q INPUT. " --log-uid --log-tcp-options --log-ip-options --log-level 7


-A INPUT -i enp2s0 -j Finet
-A INPUT -i enp4s0  -j Flan
-A INPUT -i lo   -j Flocal
-A INPUT                -j LOG      --log-prefix "ipt4: (default) DROP INPUT. " --log-uid --log-tcp-options --log-ip-options --log-level 7


COMMIT
#
# vi: ft=iptables
